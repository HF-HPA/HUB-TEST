<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hampshire Farms Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    body { background: #f4f6f8; color: #333; transition: background 0.3s, color 0.3s; }
    body.dark { background: #1e1e1e; color: #f4f4f4; }
    header {
        background: #2c3e50; color: #fff; padding: 15px 30px;
        display: flex; justify-content: space-between; align-items: center;
    }
    header h1 { font-size: 1.5rem; }
    .user-role { font-size: 1rem; }
    .dashboard { padding: 20px; display: none; }
    .filters { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
    .filters button {
        padding: 10px 20px; border: none; background: #3498db; color: #fff;
        font-size: 1rem; border-radius: 5px; cursor: pointer; transition: background 0.3s ease;
    }
    .filters button:hover { background: #2980b9; }
    .cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
    .card {
        background: #fff; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        padding: 20px; transition: transform 0.3s ease;
    }
    body.dark .card { background: #2c2c2c; }
    .card:hover { transform: translateY(-5px); }
    .card h3 { margin-bottom: 10px; color: #2c3e50; }
    body.dark .card h3 { color: #f4f4f4; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; font-size: 0.9rem; }
    th { background: #ecf0f1; }
    body.dark th { background: #444; }
    td[contenteditable="true"] { background: #f9f9f9; }
    body.dark td[contenteditable="true"] { background: #555; }
    canvas { width: 100% !important; height: 250px !important; }
    .top-controls { display: flex; justify-content: flex-end; gap: 10px; margin-bottom: 15px; }
    .top-controls button {
        padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer;
    }
    .dark-toggle { background: #555; color: #fff; }
    .export-btn { background: #27ae60; color: #fff; }
    /* Login Screen */
    .login-container {
        display: flex; justify-content: center; align-items: center; height: 100vh;
        background: #ecf0f1;
    }
    .login-box {
        background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        width: 300px; text-align: center;
    }
    .login-box h2 { margin-bottom: 20px; }
    .login-box input, .login-box select {
        width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 5px;
    }
    .login-box button {
        width: 100%; padding: 10px; background: #3498db; color: #fff; border: none; border-radius: 5px;
        cursor: pointer;
    }
</style>
</head>
<body>
<header>
    <h1>Hampshire Farms Dashboard</h1>
    <div class="user-role">Role: <span id="currentRole">None</span></div>
</header>

<!-- Login Screen -->
<div class="login-container" id="loginScreen">
    <div class="login-box">
        <h2>Login</h2>
        <input type="text" id="username" placeholder="Enter Username">
        <select id="roleSelect">
            <option value="HPA">HPA</option>
            <option value="HF">HF</option>
            <option value="ADMIN">ADMIN</option>
        </select>
        <button onclick="login()">Login</button>
    </div>
</div>

<!-- Dashboard -->
<section class="dashboard" id="dashboard">
    <div class="top-controls">
        <button class="dark-toggle" onclick="toggleDarkMode()">Toggle Dark Mode</button>
        <button class="export-btn" onclick="exportCSV()">Export CSV</button>
    </div>
    <div class="filters">
        <button onclick="filterRole('HPA')">HPA</button>
        <button onclick="filterRole('HF')">HF</button>
        <button onclick="filterRole('ADMIN')">ADMIN</button>
    </div>
    <div class="cards">
        <div class="card" id="ordersCard">
            <h3>Order Breakdown</h3>
            <table id="ordersTable">
                <thead>
                    <tr><th>Week</th><th>Category</th><th>Size</th><th>Plant Name</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="card" id="weeksCard">
            <h3>Upcoming Weeks</h3>
            <table id="weeksTable">
                <thead>
                    <tr><th>Week #</th><th>Date</th><th>Status</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="card" id="pestsCard">
            <h3>Pest Management</h3>
            <table id="pestsTable">
                <thead>
                    <tr><th>Pest</th><th>Prevention</th><th>Treatment</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="card">
            <h3>Orders by Category</h3>
            <canvas id="ordersChart"></canvas>
        </div>
    </div>
</section>

<script>
// Login System
function login() {
    const username = document.getElementById('username').value;
    const role = document.getElementById('roleSelect').value;
    if(username.trim() !== '') {
        document.getElementById('currentRole').innerText = role;
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
    } else {
        alert('Please enter a username');
    }
}

// Dark Mode Toggle
function toggleDarkMode() {
    document.body.classList.toggle('dark');
}

// Role Filter
function filterRole(role) {
    document.getElementById('currentRole').innerText = role;
}

// CSV Parsing Helper
async function loadCSV(url) {
    const response = await fetch(url);
    const data = await response.text();
    return data.split('\n').slice(1).map(row => row.split(','));
}

// Load Data
async function loadDashboard() {
    const orders = await loadCSV('OrderBreakdown.csv');
    const weeks = await loadCSV('OrderWeeks.csv');
    const pests = await loadCSV('pests.csv');

    const ordersTable = document.querySelector('#ordersTable tbody');
    orders.forEach(row => {
        if(row.length >= 4) {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td contenteditable="true">${row[0]}</td><td contenteditable="true">${row[1]}</td><td contenteditable="true">${row[2]}</td><td contenteditable="true">${row[3]}</td>`;
            ordersTable.appendChild(tr);
        }
    });

    const weeksTable = document.querySelector('#weeksTable tbody');
    weeks.forEach(row => {
        if(row.length >= 5) {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td contenteditable="true">${row[0]}</td><td contenteditable="true">${row[1]}</td><td contenteditable="true">${row[4]}</td>`;
            weeksTable.appendChild(tr);
        }
    });

    const pestsTable = document.querySelector('#pestsTable tbody');
    pests.forEach(row => {
        if(row.length >= 8) {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td contenteditable="true">${row[1]}</td><td contenteditable="true">${row[6]}</td><td contenteditable="true">${row[7]}</td>`;
            pestsTable.appendChild(tr);
        }
    });

    // Chart
    const categories = {};
    orders.forEach(row => {
        const category = row[1];
        if(category) categories[category] = (categories[category] || 0) + 1;
    });
    const ctx = document.getElementById('ordersChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: Object.keys(categories),
            datasets: [{
                label: 'Orders',
                data: Object.values(categories),
                backgroundColor: '#3498db'
            }]
        },
        options: { responsive: true, plugins: { legend: { display: false } } }
    });
}

// Export CSV
function exportCSV() {
    let csv = '';
    document.querySelectorAll('table').forEach(table => {
        const rows = table.querySelectorAll('tr');
        rows.forEach(row => {
            const cols = row.querySelectorAll('th, td');
            const rowData = Array.from(cols).map(col => `"${col.innerText}"`).join(',');
            csv += rowData + '\n';
        });
        csv += '\n';
    });
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'dashboard_data.csv';
    a.click();
}

loadDashboard();
</script>
</body>
</html>
